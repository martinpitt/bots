name: RHEL Image Build on Testing Farm
on:
  # Allow manual triggering for testing
  workflow_dispatch:
  # Uncomment to run on push to specific branches
  # push:
  #   branches: [tf-image-build]

jobs:
  test-rhel-setup:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      statuses: write
    steps:
      - name: Clone repository
        uses: actions/checkout@v5

      - name: Schedule tests on Testing Farm
        uses: sclorg/testing-farm-as-github-action@v2
        with:
          api_key: ${{ secrets.TESTING_FARM_API_KEY }}
          # Request virtualized guest with KVM support
          tmt_hardware: |
            virtualization:
              is-virtualized: true
              is-supported: true
          # Pass secrets to the test environment
          secrets: TEST_SECRET=${{ secrets.TEST_SECRET }}
          # Use our tmt plan
          tmt_plan_regex: rhel-image-build
          # Increase timeout for image building (once we do actual builds)
          timeout: 120
